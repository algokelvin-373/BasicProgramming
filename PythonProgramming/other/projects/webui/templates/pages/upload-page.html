<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>AI Virtual Try On – Modex</title>

    <!-- Google Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- CSS utama -->
    <link rel="stylesheet" href="/assets/css/upload-page.css">
</head>

<body>

    <!-- =========== HEADER =========== -->
    <header class="site-header">
        <div class="header-inner">
            <a href="../index.html" class="navbar-brand">
                <img src="/assets/img/logo.svg" alt="Modex logo" height="44">
            </a>
            <div class="header-actions">
                <!-- Tombol mobile -->
                <button class="btn-primary btn-tryon-mobile">Virtual Try On</button>
                <label for="nav-toggle" class="hamburger" tabindex="0">
                    <span></span>
                    <span></span>
                    <span></span>
                </label>
            </div>
            <!-- Nav desktop -->
            <nav class="nav-links nav-links-desktop">
                <a class="active" href="../index.html">Home</a>
                <a href="/pages/terms.html">Terms &amp; Conditions</a>
            </nav>
            <!-- Tombol desktop -->
            <button class="btn-primary btn-tryon-desktop">Virtual Try On</button>
        </div>
        <!-- Offcanvas menu mobile (dropdown) + overlay -->
        <input type="checkbox" id="nav-toggle" class="nav-toggle" hidden>

        <div class="nav-overlay"></div>
        <nav class="nav-links-mobile">
            <a class="active" href="#">Home</a>
            <a href="pages/terms.html">Terms &amp; Conditions</a>
        </nav>
    </header>


    <!-- =========== INTRO =========== -->
    <section class="section-intro">
        <h1>AI Virtual Try On&nbsp;&nbsp;– Pengubah Pakaian AI Online</h1>
        <p>Unggah foto &amp; coba berbagai outfit secara instan dengan teknologi AI.</p>
    </section>

    <!-- =========== FORM + REKOMENDASI =========== -->
    <div class="form-wrapper">

        <form class="steps">

            <div class="step-block">
                <div class="step-title">
                    <span class="num">1</span>
                    <h3>Model Image</h3>
                </div>
                <p class="small">Upload image half body atau full body dengan posisi menghadap ke depan untuk hasil
                    terbaik</p>

                <label class="file-box">
                    <span>Pilih Gambar<br><small>atau jatuhkan di sini</small></span>
                    <button type="button" class="btn-upload">Unggah</button>
                    <input type="file" name="model_img" accept="image/*">
                </label>

                <p class="allowed">JPG, JPEG, PNG</p>
            </div>

            <!-- Upper Item Section -->
            <div class="step-block">
                <div class="step-title">
                    <span class="num">2</span>
                    <h3>Upper Item</h3>
                </div>
                <p class="small">Upload image atasan tanpa latar belakang <strong>(768 × 1024 px)</strong></p>

                <div class="file-grid" id="top-items-container">
                    <button type="button" class="btn-add-item" id="add-top-btn">
                        <img src="/assets/img/plus-icon.svg" alt="Tambah" class="add-icon">
                    </button>
                </div>

                <div class="file-notes">
                    <p class="allowed">JPG, JPEG, PNG</p>
                    <p class="max-upload">*Maks upload 3 gambar</p>
                </div>
            </div>

            <!-- Lower Item Section (identical structure) -->
            <div class="step-block">
                <div class="step-title">
                    <span class="num">3</span>
                    <h3>Lower Item</h3>
                </div>
                <p class="small">Upload image bawahan tanpa latar belakang <strong>(768 × 1024 px)</strong></p>

                <div class="file-grid" id="bottom-items-container">
                    <button type="button" class="btn-add-item" id="add-bottom-btn">
                        <img src="/assets/img/plus-icon.svg" alt="Tambah" class="add-icon">
                    </button>
                </div>

                <div class="file-notes">
                    <p class="allowed">JPG, JPEG, PNG</p>
                    <p class="max-upload">*Maks upload 3 gambar</p>
                </div>
            </div>

            <div class="step-block">
                <div class="step-title">
                    <span class="num">4</span>
                    <h3>Occasion</h3>
                </div>

                <textarea class="textarea-occasion" name="occasion"
                    placeholder="Contoh : Hangout ke Mall Sore Hari"></textarea>

                <div class="action-btns">
                    <button type="reset" class="btn-outline">Ulangi</button>
                    <button type="submit" class="btn-disabled" disabled>Proses</button>
                </div>
            </div>

        </form>

        <div class="rekomendasi-box">
            <div>
                <img src="/assets/img/illustration-mixmatch.png" alt="Ilustrasi Mix &amp; Match">
                <p>Belum bisa tampil.<br>Yuk, upload item dan isi occasion dulu!</p>
            </div>
        </div>

    </div>


    <!-- =========== FOOTER =========== -->
    <footer class="site-footer">
        <div class="container footer-wrapper">

            <img src="/assets/img/logo.svg" alt="Modex logo" class="footer-logo">

            <hr>

            <div class="footer-meta">
                <small>© 2025 Modex. All Right Reserved.</small>
                <a href="terms.html" class="footer-link">Terms & Conditions</a>
            </div>

        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {

            const uploadedFiles = {
                model: null,
                topItems: [],
                bottomItems: []
            };

            // Get all necessary elements
            const form = document.querySelector('.steps');
            const textarea = document.querySelector('.textarea-occasion');
            const submitBtn = document.querySelector('button[type="submit"]');
            const resetBtn = document.querySelector('button[type="reset"]');
            const rekomendasiBox = document.querySelector('.rekomendasi-box');

            // Item management elements
            const topItemsContainer = document.getElementById('top-items-container');
            const bottomItemsContainer = document.getElementById('bottom-items-container');
            const addTopBtn = document.getElementById('add-top-btn');
            const addBottomBtn = document.getElementById('add-bottom-btn');
            const modelImgInput = document.querySelector('input[name="model_img"]');

            // Initialize with one item each
            addItem('top');
            addItem('bottom');

            // Add event listeners
            addTopBtn.addEventListener('click', () => addItem('top'));
            addBottomBtn.addEventListener('click', () => addItem('bottom'));
            textarea.addEventListener('input', checkFormCompletion);
            resetBtn.addEventListener('click', resetForm);
            modelImgInput.addEventListener('change', handleFileSelect);

            // Form submission
            form.addEventListener('submit', function (e) {
                e.preventDefault();
                // Add form submission logic here
                console.log('Form submitted!');
            });

            // Function to add a new item (top or bottom)
            function addItem(type) {
                const container = document.getElementById(`${type}-items-container`);
                const addButton = container.querySelector('.btn-add-item');
                const currentItems = container.querySelectorAll('.file-box').length;

                if (currentItems >= 3) {
                    addButton.style.display = 'none';
                    return;
                }

                const index = currentItems + 1;
                const name = `${type}_item_${index}`;

                // Hanya tampilkan delete button jika sudah ada item sebelumnya (currentItems > 0)
                const deleteButtonHTML = currentItems > 0 ? `
        <button type="button" class="delete-btn" title="Hapus item">
            <img src="/assets/img/icon/trash-icon.svg" alt="Hapus" width="10" height="10">
        </button>
    ` : '';

                const fileBox = document.createElement('label');
                fileBox.className = 'file-box';
                fileBox.innerHTML = `
        <span>Pilih Gambar<br><small>atau jatuhkan di sini</small></span>
        <button type="button" class="btn-upload">Unggah</button>
        <input type="file" name="${name}" accept="image/*">
        ${deleteButtonHTML}
    `;

                const fileInput = fileBox.querySelector('input[type="file"]');
                const deleteBtn = fileBox.querySelector('.delete-btn');

                fileInput.addEventListener('change', function (e) {
                    handleFileSelect(e);
                    checkFormCompletion();
                });

                if (deleteBtn) {
                    deleteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        container.removeChild(fileBox);

                        // Update semua item yang tersisa
                        updateDeleteButtonsVisibility(type);

                        if (container.querySelectorAll('.file-box').length < 3) {
                            addButton.style.display = 'flex';
                        }

                        // Update state global
                        if (type === 'top') {
                            uploadedFiles.topItems = uploadedFiles.topItems.filter((_, i) => i !== index - 1);
                        } else {
                            uploadedFiles.bottomItems = uploadedFiles.bottomItems.filter((_, i) => i !== index - 1);
                        }

                        checkFormCompletion();
                    });
                }

                container.insertBefore(fileBox, addButton);

                if (container.querySelectorAll('.file-box').length >= 3) {
                    addButton.style.display = 'none';
                }

                // Update visibility tombol delete pada semua item
                updateDeleteButtonsVisibility(type);

            }
            function updateDeleteButtonsVisibility(type) {
                const container = document.getElementById(`${type}-items-container`);
                const items = container.querySelectorAll('.file-box');
                const shouldShowDelete = items.length > 1;

                items.forEach((item, index) => {
                    const deleteBtn = item.querySelector('.delete-btn');
                    if (deleteBtn) {
                        if (shouldShowDelete) {
                            deleteBtn.style.display = 'block';
                        } else {
                            deleteBtn.style.display = 'none';
                        }
                    } else if (shouldShowDelete && index === 0) {
                        // Tambahkan delete button jika belum ada tapi seharusnya ditampilkan
                        const newDeleteBtn = document.createElement('button');
                        newDeleteBtn.className = 'delete-btn';
                        newDeleteBtn.title = 'Hapus item';
                        newDeleteBtn.innerHTML = '<img src="/assets/img/icon/trash-icon.svg" alt="Hapus" width="10" height="10">';
                        newDeleteBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            container.removeChild(item);
                            updateDeleteButtonsVisibility(type);
                            checkFormCompletion();
                        });
                        item.appendChild(newDeleteBtn);
                    }
                });
            }

            // Function to handle file selection and show preview
            function handleFileSelect(event) {
                const input = event.target;
                const file = input.files[0];
                const container = input.closest('.file-box');

                if (!file) return;

                const reader = new FileReader();

                reader.onload = function (e) {
                    // Simpan file dalam state global
                    if (input.name === 'model_img') {
                        uploadedFiles.model = file;
                    } else if (input.name.startsWith('top_item_')) {
                        const index = parseInt(input.name.split('_')[2]);
                        uploadedFiles.topItems[index] = file;
                    } else if (input.name.startsWith('bottom_item_')) {
                        const index = parseInt(input.name.split('_')[2]);
                        uploadedFiles.bottomItems[index] = file;
                    }

                    // Update preview
                    container.innerHTML = '';
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.style.width = '100%';
                    img.style.height = '100%';
                    img.style.objectFit = 'cover';

                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'delete-btn';
                    deleteBtn.innerHTML = '<img src="/assets/img/icon/trash-icon.svg" alt="Hapus">';
                    deleteBtn.onclick = () => {
                        container.innerHTML = `
                <span>Pilih Gambar<br><small>atau jatuhkan di sini</small></span>
                <button type="button" class="btn-upload">Unggah</button>
                <input type="file" name="${input.name}" accept="image/*">
            `;
                        // Reset state
                        if (input.name === 'model_img') {
                            uploadedFiles.model = null;
                        } else if (input.name.startsWith('top_item_')) {
                            const index = parseInt(input.name.split('_')[2]);
                            uploadedFiles.topItems[index] = null;
                        } else if (input.name.startsWith('bottom_item_')) {
                            const index = parseInt(input.name.split('_')[2]);
                            uploadedFiles.bottomItems[index] = null;
                        }
                        checkFormCompletion();
                    };

                    container.appendChild(img);
                    container.appendChild(deleteBtn);

                    // Simpan input file yang tersembunyi
                    const hiddenInput = document.createElement('input');
                    hiddenInput.type = 'file';
                    hiddenInput.name = input.name;
                    hiddenInput.style.display = 'none';
                    hiddenInput.addEventListener('change', handleFileSelect);
                    container.appendChild(hiddenInput);

                    checkFormCompletion();
                };

                reader.readAsDataURL(file);
            }

            // Function to reset a file box to its initial state
            function resetFileBox(container, inputName) {
                container.innerHTML = `
            <span>Pilih Gambar<br><small>atau jatuhkan di sini</small></span>
            <button type="button" class="btn-upload">Unggah</button>
            <input type="file" name="${inputName}" accept="image/*">
        `;
                container.querySelector('input').addEventListener('change', handleFileSelect);
            }

            // Check if all forms are filled
            function checkFormCompletion() {
                const hasModelImage = !!uploadedFiles.model;
                const hasUpperItem = uploadedFiles.topItems.some(file => file !== null);
                const hasLowerItem = uploadedFiles.bottomItems.some(file => file !== null);
                const hasOccasion = textarea.value.trim().length > 0;


                if (hasModelImage && hasUpperItem && hasLowerItem && hasOccasion) {
                    submitBtn.disabled = false;
                    submitBtn.classList.remove('btn-disabled');
                    submitBtn.classList.add('btn-primary');
                } else {
                    submitBtn.disabled = true;
                    submitBtn.classList.add('btn-disabled');
                    submitBtn.classList.remove('btn-primary');
                }
            }
            // Reset entire form
            function resetForm() {
                // Reset model image
                const modelImg = document.querySelector('input[name="model_img"]');
                modelImg.value = '';
                const modelFileBox = modelImg.closest('.file-box');
                if (modelFileBox) {
                    modelFileBox.innerHTML = `
                <span>Pilih Gambar<br><small>atau jatuhkan di sini</small></span>
                <button type="button" class="btn-upload">Unggah</button>
                <input type="file" name="model_img" accept="image/*">
            `;
                    modelFileBox.querySelector('input').addEventListener('change', handleFileSelect);
                }

                // Reset top items
                topItemsContainer.innerHTML = `
        <button type="button" class="btn-add-item" id="add-top-btn">
            <img src="/assets/img/plus-icon.svg" alt="Tambah" class="add-icon">
            <span>Tambah Item</span>
        </button>
    `;
                document.getElementById('add-top-btn').addEventListener('click', () => addItem('top'));
                addItem('top'); // Akan membuat item pertama tanpa delete button

                // Reset bottom items
                bottomItemsContainer.innerHTML = `
        <button type="button" class="btn-add-item" id="add-bottom-btn">
            <img src="/assets/img/plus-icon.svg" alt="Tambah" class="add-icon">
            <span>Tambah Item</span>
        </button>
    `;
                document.getElementById('add-bottom-btn').addEventListener('click', () => addItem('bottom'));
                addItem('bottom');

                // Reset occasion text
                textarea.value = '';

                // Reset submit button
                submitBtn.disabled = true;
                submitBtn.classList.add('btn-disabled');
                submitBtn.classList.remove('btn-primary');

                // Reset recommendation box
                rekomendasiBox.innerHTML = `
            <div>
                <img src="/assets/img/illustration-mixmatch.png" alt="Ilustrasi Mix &amp; Match">
                <p>Belum bisa tampil.<br>Yuk, upload item dan isi occasion dulu!</p>
            </div>
        `;
            }

            // Initialize file input listeners for any dynamically added elements
            document.addEventListener('change', function (e) {
                if (e.target.matches('input[type="file"]')) {
                    handleFileSelect(e);
                }
            });

            // mobile-panel
            const navToggle = document.querySelector('.nav-toggle');
            const navOverlay = document.querySelector('.nav-overlay');
            if (navOverlay && navToggle) {
                navOverlay.addEventListener('click', function () {
                    navToggle.checked = false;
                });
            }
        });
    </script>

</body>

</html>